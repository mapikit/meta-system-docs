<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<title data-react-helmet="true">DB Protocols Code | Meta-System</title><meta data-react-helmet="true" property="og:url" content="https://mapikit.github.io/meta-system-docs/docs/guides/writing-db-protocols"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="DB Protocols Code | Meta-System"><meta data-react-helmet="true" name="description" content="This is not the full guide for DB Protocols. Please refer to the &quot;Writing Protocols&quot; page for the information that encompasses both normal and DB protocols."><meta data-react-helmet="true" property="og:description" content="This is not the full guide for DB Protocols. Please refer to the &quot;Writing Protocols&quot; page for the information that encompasses both normal and DB protocols."><link data-react-helmet="true" rel="shortcut icon" href="/meta-system-docs/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://mapikit.github.io/meta-system-docs/docs/guides/writing-db-protocols"><link data-react-helmet="true" rel="alternate" href="https://mapikit.github.io/meta-system-docs/docs/guides/writing-db-protocols" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://mapikit.github.io/meta-system-docs/docs/guides/writing-db-protocols" hreflang="x-default"><link rel="stylesheet" href="/meta-system-docs/assets/css/styles.e3e3e5d0.css">
<link rel="preload" href="/meta-system-docs/assets/js/runtime~main.73d979ae.js" as="script">
<link rel="preload" href="/meta-system-docs/assets/js/main.43e64447.js" as="script">
</head>
<body data-theme="dark">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/meta-system-docs/"><img src="/meta-system-docs/img/logo_metasystem.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/meta-system-docs/img/logo_metasystem.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Meta-System</b></a><a class="navbar__item navbar__link" href="/meta-system-docs/docs/api-docs/getting-started">Docs</a><a class="navbar__item navbar__link navbar__link--active" href="/meta-system-docs/docs/guides/guides-introduction">Guides</a><a class="navbar__item navbar__link" href="/meta-system-docs/docs/tutorials/tutorials">Tutorials</a><a class="navbar__item navbar__link" href="/meta-system-docs/docs/our-packages/our-packages-intro">Packages</a></div><div class="navbar__items navbar__items--right"><div class="dsla-search-wrapper"><div class="dsla-search-field"></div></div><a href="https://github.com/mapikit/meta-system" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://discord.gg/ndGsnbTW7V" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/meta-system-docs/docs/guides/guides-introduction">Guides</a></li><li class="menu__list-item"><a class="menu__link" href="/meta-system-docs/docs/guides/writing-packages-and-functions">Writing Packages And Functions</a></li><li class="menu__list-item"><a class="menu__link" href="/meta-system-docs/docs/guides/writing-protocols">Writing Protocols</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" href="/meta-system-docs/docs/guides/writing-db-protocols">DB Protocols Code</a></li><li class="menu__list-item"><a class="menu__link" href="/meta-system-docs/docs/guides/contributing">Contributing</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">DB Protocols Code</h1></header><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>This is not the full guide for DB Protocols. Please refer to the <a href="/meta-system-docs/docs/guides/writing-protocols">&quot;Writing Protocols&quot;</a> page for the information that encompasses both normal and DB protocols.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-the-code"></a>2. The Code<a class="hash-link" href="#2-the-code" title="Direct link to heading">#</a></h2><blockquote><p>See step 1 <a href="/meta-system-docs/docs/guides/writing-protocols#1-requirements">here</a>.</p></blockquote><p>After you already have all the requirements, you can code away! The expected interface of a <strong>DB protocol</strong> protocol is a class that extends <code>DBProtocol</code>, and provides a type for its configuration parameters (only needed if using typescript).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="configuration-parameters"></a>Configuration Parameters<a class="hash-link" href="#configuration-parameters" title="Direct link to heading">#</a></h3><p>We believe that you, the author of this awesome Protocol, should have the rights to define what it needs to be configured and functional, and this is the place for doing it. You should accept an object as the first argument in the constructor, which contains all the parameters you want, with any structure you can imagine, just be sure to provide us with the method for validating it (<a href="#validateconfiguration---returns-void">see below</a>). If the user provides an invalid configuration for your protocol, Meta-System will fail to boot.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="constructor"></a>Constructor<a class="hash-link" href="#constructor" title="Direct link to heading">#</a></h3><p>For <strong>DB Protocols</strong> you will receive the following arguments:</p><ul><li>Your Protocol&#x27;s configuration parameters;</li><li>The array of schemas you need to boot with.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">constructor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">configuration</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"> schemaList</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">super</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">configuration</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> schemaList</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><blockquote><p>It is recommended to bind your methods in the constructor.</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="methods"></a>Methods<a class="hash-link" href="#methods" title="Direct link to heading">#</a></h3><p>There are some functions we require you to implement for your DB protocol to be valid.
You must declare the following methods:</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="initialize---returns-void"></a><strong><code>initialize</code></strong> - returns <code>void</code><a class="hash-link" href="#initialize---returns-void" title="Direct link to heading">#</a></h4><p>This method should boot the connection to the database, and prepare it for being used by schemas. If there&#x27;s any migration to happen, it should be done at this stage. This method can be Async.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>DB Protocols are responsible for configuring and preparing the database to be used with the user schemas. This means that you will need to generate the tables, columns, and relationships when this method executes.</p></div></div><p>There is a helper method provided by the <code>DBProtocol&lt;T&gt;</code> class we&#x27;re supposed to extend. It is called <code>this.checkSchemaDiff()</code> and can aid on finding differences in versions of Schemas. </p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="shutdown---returns-void"></a><strong><code>shutdown</code></strong> - returns <code>void</code><a class="hash-link" href="#shutdown---returns-void" title="Direct link to heading">#</a></h4><p>This method should close all the connections open to any database. Additionally, you may save some state on the Database to help on the next boot. This method can be Async.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="validateconfiguration---returns-void"></a><strong><code>validateConfiguration</code></strong> - returns <code>void</code><a class="hash-link" href="#validateconfiguration---returns-void" title="Direct link to heading">#</a></h4><p>This method is required and is executed by Meta-System in order to be sure that a valid configuration for your protocol was provided. It should validate every parameter specified in your user configuration.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Errors</h5></div><div class="admonition-content"><p>Every validation in this method should throw an error if failed. Prefer error messages that guide the user to solving the configuration issues encountered.</p></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="getprotocolpublicmethods---returns-an-object-containing-functions-to-be-used-in-bops"></a><strong><code>getProtocolPublicMethods</code></strong> - returns an object containing functions to be used in BOps<a class="hash-link" href="#getprotocolpublicmethods---returns-an-object-containing-functions-to-be-used-in-bops" title="Direct link to heading">#</a></h4><p>This is the method you should use when you want to provide a way of interacting with your protocol from the BOps flow, such as forcibly send an error to the user, or getting a connection value. If there are no such interactions for your protocol, return an empty object.</p><p>If you do want to provide them, their name should be keys in the object, while their function declarations are the values.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="additional-methods-for-db-protocols"></a>Additional Methods For DB Protocols<a class="hash-link" href="#additional-methods-for-db-protocols" title="Direct link to heading">#</a></h3><p>DB protocols also requires the functions to provide the Schema access to the Database. They are all specified in the <a href="/meta-system-docs/docs/api-docs/functions/schema-functions/intro#the-recommended-interface">Schema-Functions</a> section. All of them must be declared to the DB protocol to be valid.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Take note!</h5></div><div class="admonition-content"><p>The <strong>inputs</strong> on the code looks different to what we have on the documentation! For every method in the <a href="/meta-system-docs/docs/api-docs/functions/schema-functions/intro#the-recommended-interface">Schema-Functions</a> section, the DB protocol should actually receive their data as the following:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">methodName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">schemaIdentifier</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"> input</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li><code>schemaIdentifier</code> Is the identifier of the schema for the wanted operation;</li><li><code>input</code> is the input of your method, and what you should expose as the documentation for this method. Meta-System handles the identifier internally.</li></ul><p>Another reminder: If the recommended interface does not suit your needs well enough, you may pick one that does. Don&#x27;t forget to document it though!</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-the-configuration-file"></a>3. The Configuration File<a class="hash-link" href="#3-the-configuration-file" title="Direct link to heading">#</a></h2><p>From this step onwards, the documentation for both protocols are the same, so you may go back to reading from <a href="/meta-system-docs/docs/guides/writing-protocols#3-the-configuration-file">here</a>.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/mapikit/meta-system-docs/edit/main/docs/guides/writing-db-protocols.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/meta-system-docs/docs/guides/writing-protocols"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Writing Protocols</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/meta-system-docs/docs/guides/contributing"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Contributing »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#2-the-code" class="table-of-contents__link">2. The Code</a><ul><li><a href="#configuration-parameters" class="table-of-contents__link">Configuration Parameters</a></li><li><a href="#constructor" class="table-of-contents__link">Constructor</a></li><li><a href="#methods" class="table-of-contents__link">Methods</a></li><li><a href="#additional-methods-for-db-protocols" class="table-of-contents__link">Additional Methods For DB Protocols</a></li></ul></li><li><a href="#3-the-configuration-file" class="table-of-contents__link">3. The Configuration File</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/mapikit/meta-system" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://discord.gg/ndGsnbTW7V" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Meta-System was built by Mapikit and follows the GPL-3.0 License. Documentation page built with Docusaurus.</div></div></div></footer></div>
<script src="/meta-system-docs/assets/js/runtime~main.73d979ae.js"></script>
<script src="/meta-system-docs/assets/js/main.43e64447.js"></script>
</body>
</html>